# This file contains the commands to build driver applications using the common set of plugins
# The variable PROD_NAME must be defined, and is used to optionally add NDFileMagick to $(PROD_NAME)Include.dbd

$(PROD_NAME)_DBD += commonDriverSupport.dbd

PROD_LIBS               += NDPlugin ADBase netCDF
PROD_LIBS               += calc busy sscan autosave
PROD_LIBS               += asyn
PROD_LIBS               += $(EPICS_BASE_IOC_LIBS)

# The following libraries are only needed for GraphicsMagick
ifeq ($(USE_GRAPHICSMAGICK), YES)
  PROD_LIBS_WIN32       += CORE_RL_Magick++_ CORE_RL_wand_ CORE_RL_magick_ 
  PROD_LIBS_WIN32       += CORE_RL_coders_ CORE_RL_filters_
  PROD_LIBS_WIN32       += CORE_RL_bzlib_ CORE_RL_jbig_ CORE_RL_jp2_ CORE_RL_jpeg_ CORE_RL_lcms_
  PROD_LIBS_WIN32       += CORE_RL_libxml_ CORE_RL_png_ CORE_RL_tiff_ CORE_RL_ttf_ CORE_RL_wmf_
  PROD_LIBS_WIN32       += CORE_RL_xlib_ CORE_RL_zlib_

  PROD_LIBS_cygwin32    += libGraphicsMagick++ libGraphicsMagickWand libGraphicsMagick
  PROD_LIBS_cygwin32    += liblcms libpng14 libbz2 libfreetype

  # The following system libraries must be installed to use GraphicsMagick
  PROD_SYS_LIBS_Linux   += GraphicsMagick++ GraphicsMagickWand GraphicsMagick
  PROD_SYS_LIBS_Linux   += gomp X11 xml2 png12 bz2 Xext freetype 

  # To use system versions of these libraries use this line
  #LIB_SYS_LIBS_Darwin  += GraphicsMagick++ GraphicsMagickWand GraphicsMagick
  #PROD_SYS_LIBS_Darwin += GraphicsMagick++ GraphicsMagickWand GraphicsMagick
  # To use versions of these libraries supplied with areaDetector use this line
  PROD_SYS_LIBS_Darwin  += png xml2 bz2
else
  # I don't understand why we need to set this when building statically and not using GraphicsMagick
  ifeq ($(STATIC_BUILD), YES)
    USR_LDFLAGS_WIN32   += /NODEFAULTLIB:MSVCRT.lib
  endif
  PROD_LIBS_WIN32       += tiff jpeg
endif
ifeq (win32-x86-debug, $(findstring win32-x86-debug, $(T_A)))
  USR_LDFLAGS_WIN32     += /NODEFAULTLIB:LIBCMT.lib
endif

PROD_LIBS_WIN32         += NeXus
ifeq ($(STATIC_BUILD), NO)
  PROD_LIBS_WIN32       += hdf5dll szip zlib1
else
  PROD_LIBS_WIN32       += hdf5 libszip zlib
endif

PROD_SYS_LIBS_WIN32     += Gdi32 Oleaut32

PROD_LIBS_cygwin32      += NeXus libhdf5 libsz
PROD_LIBS_cygwin32      += libtiff libjpeg libjbig libz libxml2.dll
PROD_SYS_LIBS_cygwin32  += $(CYGWIN_RPC_LIB)
PROD_SYS_LIBS_cygwin32  += Gdi32

# Nexus is built from source in areaDetector
PROD_LIBS_Linux         += NeXus
# The following system libraries must be installed
PROD_SYS_LIBS_Linux     += hdf5 sz
PROD_SYS_LIBS_Linux     += tiff jpeg z

# Nexus is built from source in areaDetector
PROD_LIBS_solaris       += NeXus
# The following system libraries must be installed
PROD_LIBS_solaris       += hdf5 sz
PROD_SYS_LIBS_solaris   += tiff jpeg z

USR_LDFLAGS_Darwin      += -framework CoreFoundation
# Nexus is built from source in areaDetector
PROD_LIBS_Darwin        += NeXus
# The following system libraries must be installed
PROD_SYS_LIBS_Darwin    += hdf5 sz
PROD_SYS_LIBS_Darwin    += tiff jpeg z

